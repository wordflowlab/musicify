{
  "meta": {
    "version": "1.0",
    "description": "MIDI 解析规则库 - 定义音符映射、时值解析、节奏型识别和调式推断规则",
    "created_for": "Musicify 旋律风格学习 Skill"
  },

  "noteMapping": {
    "midiToName": {
      "36": "C2", "37": "C#2", "38": "D2", "39": "D#2", "40": "E2", "41": "F2",
      "42": "F#2", "43": "G2", "44": "G#2", "45": "A2", "46": "A#2", "47": "B2",
      "48": "C3", "49": "C#3", "50": "D3", "51": "D#3", "52": "E3", "53": "F3",
      "54": "F#3", "55": "G3", "56": "G#3", "57": "A3", "58": "A#3", "59": "B3",
      "60": "C4", "61": "C#4", "62": "D4", "63": "D#4", "64": "E4", "65": "F4",
      "66": "F#4", "67": "G4", "68": "G#4", "69": "A4", "70": "A#4", "71": "B4",
      "72": "C5", "73": "C#5", "74": "D5", "75": "D#5", "76": "E5", "77": "F5",
      "78": "F#5", "79": "G5", "80": "G#5", "81": "A5", "82": "A#5", "83": "B5",
      "84": "C6", "85": "C#6", "86": "D6", "87": "D#6", "88": "E6", "89": "F6",
      "90": "F#6", "91": "G6", "92": "G#6", "93": "A6", "94": "A#6", "95": "B6"
    },
    "midiToJianpu": {
      "description": "基于 C 大调的简谱映射，实际使用时需根据调号偏移",
      "baseKey": "C",
      "mapping": {
        "0": "1", "2": "2", "4": "3", "5": "4", "7": "5", "9": "6", "11": "7"
      },
      "octaveMarkers": {
        "-2": ",,", "-1": ",", "0": "", "1": "'", "2": "''"
      }
    }
  },

  "durationMapping": {
    "ticksPerBeat": 480,
    "durationNames": {
      "1920": { "name": "全音符", "symbol": "○", "beats": 4 },
      "1440": { "name": "附点二分音符", "symbol": "●.", "beats": 3 },
      "960": { "name": "二分音符", "symbol": "●", "beats": 2 },
      "720": { "name": "附点四分音符", "symbol": "♩.", "beats": 1.5 },
      "480": { "name": "四分音符", "symbol": "♩", "beats": 1 },
      "360": { "name": "附点八分音符", "symbol": "♪.", "beats": 0.75 },
      "240": { "name": "八分音符", "symbol": "♪", "beats": 0.5 },
      "180": { "name": "附点十六分音符", "symbol": "♬.", "beats": 0.375 },
      "120": { "name": "十六分音符", "symbol": "♬", "beats": 0.25 },
      "160": { "name": "三连音（四分）", "symbol": "♩³", "beats": 0.333 },
      "80": { "name": "三连音（八分）", "symbol": "♪³", "beats": 0.167 }
    },
    "tolerancePercent": 10
  },

  "rhythmPatterns": {
    "quarter": {
      "name": "四分音符型",
      "durations": [480],
      "description": "稳定的四分音符节奏，常用于叙述性段落",
      "category": "basic"
    },
    "eighth": {
      "name": "八分音符型",
      "durations": [240, 240],
      "description": "连续八分音符，增加流动感",
      "category": "basic"
    },
    "dotted_quarter_eighth": {
      "name": "附点四分+八分",
      "durations": [720, 240],
      "description": "附点节奏，增加推动力",
      "category": "dotted"
    },
    "eighth_dotted_quarter": {
      "name": "八分+附点四分",
      "durations": [240, 720],
      "description": "切分感的附点节奏",
      "category": "dotted"
    },
    "syncopation_basic": {
      "name": "基本切分",
      "durations": [240, 480, 240],
      "description": "基本切分节奏，强拍弱化",
      "category": "syncopation"
    },
    "syncopation_offbeat": {
      "name": "后半拍切分",
      "durations": [240, 240, 480],
      "description": "后半拍强调的切分",
      "category": "syncopation"
    },
    "triplet_quarter": {
      "name": "四分三连音",
      "durations": [160, 160, 160],
      "description": "三连音节奏，增加流畅感",
      "category": "triplet"
    },
    "long_short": {
      "name": "长短型",
      "durations": [960, 480],
      "description": "二分+四分，舒缓的节奏",
      "category": "basic"
    },
    "sixteenth_group": {
      "name": "十六分音符组",
      "durations": [120, 120, 120, 120],
      "description": "快速的十六分音符，增加紧张感",
      "category": "fast"
    }
  },

  "modeDetection": {
    "description": "基于五声音阶特征音检测调式",
    "pentatonic": {
      "gong": {
        "name": "宫调式",
        "characteristicDegrees": [0, 2, 4, 7, 9],
        "rootDegree": 0,
        "endingNotes": [0, 7],
        "weight": { "root": 3, "fifth": 2, "others": 1 }
      },
      "shang": {
        "name": "商调式",
        "characteristicDegrees": [0, 2, 4, 7, 9],
        "rootDegree": 2,
        "endingNotes": [2, 0],
        "weight": { "root": 3, "fifth": 2, "others": 1 }
      },
      "jue": {
        "name": "角调式",
        "characteristicDegrees": [0, 2, 4, 7, 9],
        "rootDegree": 4,
        "endingNotes": [4, 2],
        "weight": { "root": 3, "fifth": 2, "others": 1 }
      },
      "zhi": {
        "name": "徵调式",
        "characteristicDegrees": [0, 2, 4, 7, 9],
        "rootDegree": 7,
        "endingNotes": [7, 9],
        "weight": { "root": 3, "fifth": 2, "others": 1 }
      },
      "yu": {
        "name": "羽调式",
        "characteristicDegrees": [0, 2, 4, 7, 9],
        "rootDegree": 9,
        "endingNotes": [9, 7],
        "weight": { "root": 3, "fifth": 2, "others": 1 }
      }
    },
    "keySignatures": {
      "C": 0, "C#": 1, "Db": 1, "D": 2, "D#": 3, "Eb": 3,
      "E": 4, "F": 5, "F#": 6, "Gb": 6, "G": 7, "G#": 8,
      "Ab": 8, "A": 9, "A#": 10, "Bb": 10, "B": 11
    }
  },

  "trackMatching": {
    "vocalRangeMin": 48,
    "vocalRangeMax": 84,
    "vocalRangeDescription": "人声音域范围 C3(48) 到 C6(84)",
    "vocalRangeZones": {
      "belowVocal": { "min": 0, "max": 47, "description": "低于人声范围，可能是贝斯" },
      "vocalLow": { "min": 48, "max": 59, "description": "C3-B3，男声常用区" },
      "vocalMid": { "min": 60, "max": 71, "description": "C4-B4，男女声共用区" },
      "vocalHigh": { "min": 72, "max": 84, "description": "C5-C6，女声常用区" },
      "aboveVocal": { "min": 85, "max": 127, "description": "高于人声范围，可能是装饰音" }
    },
    "tolerancePercent": 15,
    "minVocalRangeOverlap": 0.5,
    "priorityKeywords": ["vocal", "melody", "voice", "lead", "主旋律", "人声"],
    "matchingRules": [
      {
        "rule": "keyword_match",
        "description": "音轨名称包含人声关键词时优先选择",
        "priority": 1,
        "scoreBonus": 30
      },
      {
        "rule": "note_count_match",
        "description": "音符数量与歌词字数最接近的音轨",
        "priority": 2,
        "maxScore": 40,
        "toleranceLevels": {
          "exact": { "tolerance": 0, "score": 40 },
          "close": { "tolerance": 0.05, "score": 35 },
          "acceptable": { "tolerance": 0.15, "score": 28 }
        }
      },
      {
        "rule": "pitch_range_filter",
        "description": "过滤音域超出人声范围的音轨",
        "priority": 3,
        "maxScore": 30,
        "overlapScoring": {
          "full": { "minOverlap": 1.0, "score": 30 },
          "high": { "minOverlap": 0.75, "score": 22 },
          "medium": { "minOverlap": 0.5, "score": 15 },
          "low": { "minOverlap": 0, "score": 0 }
        }
      }
    ],
    "confidenceThresholds": {
      "high": 90,
      "medium": 70,
      "low": 50
    },
    "confidenceDescriptions": {
      "high": "自动选择，无需确认",
      "medium": "建议选择，请求确认",
      "low": "需要用户手动确认",
      "noMatch": "不推荐，列出供参考"
    },
    "conflictResolution": {
      "scoreDifferenceThreshold": 5,
      "priorityOrder": ["keyword_match", "note_count_match", "pitch_range_filter"]
    }
  },

  "intervalClassification": {
    "stepwise": {
      "name": "级进",
      "semitones": [1, 2],
      "description": "相邻音级的进行，旋律流畅"
    },
    "smallLeap": {
      "name": "小跳",
      "semitones": [3, 4],
      "description": "三度或四度跳进，增加起伏"
    },
    "largeLeap": {
      "name": "大跳",
      "semitones": [5, 6, 7, 8, 9, 10, 11, 12],
      "description": "五度及以上跳进，戏剧性强"
    }
  },

  "contourAnalysis": {
    "ascending": {
      "name": "上行",
      "condition": "后一音高于前一音",
      "emotion": "积极、上升、期待"
    },
    "descending": {
      "name": "下行",
      "condition": "后一音低于前一音",
      "emotion": "忧伤、下沉、释放"
    },
    "stable": {
      "name": "平稳",
      "condition": "音高变化在二度以内",
      "emotion": "平静、叙述、稳定"
    }
  }
}
