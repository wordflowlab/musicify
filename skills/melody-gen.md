---
name: melody-gen
description: 国风旋律生成助手 - 将歌词转换为五声音阶简谱
category: composition
version: "1.0"
resources:
  - pentatonic-rules.json
  - guofeng-patterns.json
allowed-tools:
  - executeBashScript
  - displaySuccess
  - displayInfo
---

# 🎼 国风旋律生成助手 (Claude Code Enhanced)

> **将歌词转换为符合五声音阶的简谱旋律**
>
> 融合中国传统音乐理论与智能生成，创作具有东方韵味的旋律

## 🎵 核心能力

### 五声音阶约束
- **调式系统**: 支持宫、商、角、徵、羽五种调式
- **音阶规则**: 严格遵循五声音阶（1、2、3、5、6），避免半音（4、7）
- **装饰音**: 滑音、颤音、倚音、波音等国风特色装饰

### 情绪旋律映射
- **忧伤**: 下行旋律 + 羽调式 + 滑音装饰
- **欢快**: 上行旋律 + 宫调式 + 波音装饰
- **平静**: 级进旋律 + 角调式 + 少量装饰
- **激昂**: 波浪旋律 + 徵调式 + 大跳进
- **思念**: 婉转旋律 + 商调式 + 滑音装饰
- **空灵**: 飘逸旋律 + 角调式 + 颤音装饰

### 结构差异处理
- **主歌**: 音域较窄（六度内），旋律平稳，叙述性强
- **副歌**: 音域扩展（可达十度），情感爆发，起伏大
- **桥段**: 上行推进，为副歌做准备

## 🎶 创作流程引导

### 第一步：调式选择

请选择适合歌曲情感的调式：

| 调式 | 主音 | 情感特征 | 适用场景 |
|------|------|----------|----------|
| 宫调式 | 1 (Do) | 庄重、明亮、欢快 | 喜庆、积极向上的歌曲 |
| 商调式 | 2 (Re) | 深沉、内敛、思念 | 怀旧、思念主题的歌曲 |
| 角调式 | 3 (Mi) | 清新、空灵、飘逸 | 意境悠远、禅意的歌曲 |
| 徵调式 | 5 (Sol) | 热情、奔放、激昂 | 豪迈、励志的歌曲 |
| 羽调式 | 6 (La) | 忧伤、婉转、柔美 | 抒情、哀怨的歌曲 |

### 第二步：情绪选择

根据歌词内容选择主要情绪：

- **忧伤** (sorrowful): 慢板 60-72 BPM，下行旋律，羽调式
- **欢快** (joyful): 快板 120-140 BPM，上行旋律，宫调式
- **平静** (peaceful): 中板 80-96 BPM，平稳旋律，角调式
- **激昂** (passionate): 快板 116-132 BPM，波浪旋律，徵调式
- **思念** (nostalgic): 慢板 66-80 BPM，婉转旋律，商调式
- **空灵** (ethereal): 自由节拍，飘逸旋律，角调式

### 第三步：拍号选择

常用拍号及其特点：

- **4/4 拍**: 最常用，稳定规整，适合大多数歌曲
- **3/4 拍**: 圆舞曲感，流动优美，适合抒情歌曲
- **6/8 拍**: 复合拍子，摇曳感强，适合民谣风格

## 📝 歌词解析规则

### 段落识别

根据歌词结构识别不同段落类型：

```
[主歌/Verse]    - 叙述性段落，音域较窄
[副歌/Chorus]   - 情感高潮，音域扩展
[桥段/Bridge]   - 过渡段落，推向高潮
[前奏/Intro]    - 器乐引入
[间奏/Interlude] - 器乐过渡
[尾声/Outro]    - 结束段落
```

### 字数统计

每句歌词的字数决定音符数量：

- 统计每句的汉字数量
- 一字对应一个音符（基本原则）
- 长音可用延长符号（-）表示
- 装饰音不占用歌词字数

### 断句点识别

识别歌词中的自然断句点：

1. **标点符号**: 逗号、句号、问号、感叹号
2. **语义停顿**: 主谓之间、动宾之间
3. **呼吸点**: 适合演唱换气的位置
4. **重音位置**: 情感强调的字词

## 🎵 旋律生成规则

### 五声音阶约束

**允许的音符**: 1 (宫)、2 (商)、3 (角)、5 (徵)、6 (羽)

**禁止的音符**: 4 (清角)、7 (变宫) - 这两个音会破坏五声音阶的纯净感

**音程规则**:
- 优先使用级进（二度）保持旋律流畅
- 跳进后宜用级进反向进行
- 避免连续大跳进（超过五度）
- 句尾常用下行级进解决到主音

### 情绪走向规则

根据选定的情绪应用对应的旋律走向：

**忧伤 (sorrowful)**:
```
走向: 下行为主
音程: 级进为主，偶有小跳（三度内）
句尾: 常落在羽音(6)或商音(2)
装饰: 多用滑音(↗↘)和颤音(~)
```

**欢快 (joyful)**:
```
走向: 上行为主
音程: 跳进较多，节奏活泼
句尾: 常落在宫音(1)或徵音(5)
装饰: 多用波音(∿)
```

**平静 (peaceful)**:
```
走向: 平稳
音程: 以级进为主，避免大跳
句尾: 音域范围较窄
装饰: 少而精
```

**激昂 (passionate)**:
```
走向: 波浪式，起伏大
音程: 跳进多，张力强
句尾: 常有力度强调
装饰: 多用倚音
```

### 装饰音添加规则

**滑音 (↗ ↘)**:
- 使用场景: 句尾延长音、情感转折处、模仿人声哭腔
- 标记方式: 5↗6 表示从5滑向6

**颤音 (~)**:
- 使用场景: 长音装饰、情感强调、模仿弦乐器效果
- 标记方式: 5~ 表示在5上颤音

**倚音 (小音符)**:
- 使用场景: 乐句开头、强拍装饰、增加韵味
- 标记方式: (3)5 表示3是5的倚音

**波音 (∿)**:
- 使用场景: 轻快段落、活泼情绪、增加灵动感
- 标记方式: 5∿ 表示在5上波音

## 📄 输出格式规范

### 简谱文本格式

标准简谱输出格式：

```
1=C 4/4  BPM=80

[主歌]
| 5  3  2  1 | 6  -  -  - | 5  6  1' 6 | 5  -  -  - |
  风 吹 过 江   南            烟 雨 朦  胧   中

| 3  5  6  5 | 3  2  1  - | 2  3  5  3 | 2  -  -  - |
  谁 在 等 候   那 一 场     梦    醒 时 分   后

[副歌]
| 1' 6  5  3 | 5  6  1' - | 6  5  3  2 | 1  -  -  - |
  多 少 往 事   随 风 去      化 作 云 烟   散
```

**格式说明**:
- `1=C`: 调号，1音对应C调
- `4/4`: 拍号，四四拍
- `BPM=80`: 速度，每分钟80拍
- `|`: 小节线
- `1 2 3 5 6`: 五声音阶音符
- `1'`: 高八度（音符后加撇）
- `1,`: 低八度（音符后加逗号）
- `-`: 延长一拍
- `.`: 附点（延长一半时值）
- `↗ ↘`: 滑音
- `~`: 颤音

### JSON 音符数据格式

详细的音符数据输出：

```json
{
  "key": "C",
  "timeSignature": "4/4",
  "bpm": 80,
  "mode": "yu",
  "emotion": "sorrowful",
  "sections": [
    {
      "name": "verse",
      "measures": [
        {
          "notes": [
            {"pitch": 5, "octave": 0, "duration": 1, "lyric": "风"},
            {"pitch": 3, "octave": 0, "duration": 1, "lyric": "吹"},
            {"pitch": 2, "octave": 0, "duration": 1, "lyric": "过"},
            {"pitch": 1, "octave": 0, "duration": 1, "lyric": "江"}
          ]
        },
        {
          "notes": [
            {"pitch": 6, "octave": 0, "duration": 4, "lyric": "南", "ornament": "chanyin"}
          ]
        }
      ]
    }
  ]
}
```

**字段说明**:
- `pitch`: 音高 (1-6)
- `octave`: 八度 (0=中音, 1=高八度, -1=低八度)
- `duration`: 时值 (1=四分音符, 0.5=八分音符, 2=二分音符, 4=全音符)
- `lyric`: 对应歌词
- `ornament`: 装饰音类型 (huayin/chanyin/yiyin/boyin)

### 音乐软件格式说明

**ACE-Studio 导入**:
- 支持 MIDI 格式导入
- 可将 JSON 数据转换为 MIDI 文件
- 建议使用 BPM 和调号信息设置项目

**Synthesizer V 导入**:
- 支持 MIDI 和 SVP 格式
- JSON 数据可转换为 SVP 项目文件
- 歌词信息可直接映射到音符

**通用 MIDI 导出**:
- 音符映射: 1=C4, 2=D4, 3=E4, 5=G4, 6=A4
- 高八度: 1'=C5, 低八度: 1,=C3
- 时值映射: 四分音符=480 ticks (标准 MIDI)

## 🎯 使用示例

### 示例输入

```
歌词：
[主歌]
风吹过江南
烟雨朦胧中
谁在等候
那一场梦

调式：羽调式
情绪：忧伤
拍号：4/4
速度：80 BPM
```

### 示例输出

```
1=C 4/4  BPM=80  羽调式

[主歌]
| 5  3  2  1 | 6~ -  -  - |
  风 吹 过 江   南

| 5  6  1' 6 | 5  -  -  - |
  烟 雨 朦  胧   中

| 3  5  6↘5 | 3  2  -  - |
  谁 在 等  候

| 2  3  5  3 | 6  -  -  - |
  那 一 场 梦
```

## 💡 创作建议

### 旋律写作技巧

1. **起承转合**: 主歌铺垫 → 副歌爆发 → 桥段过渡 → 尾声收束
2. **动机发展**: 建立核心动机，通过变化重复发展
3. **高潮设计**: 副歌最高音放在情感最强处
4. **呼吸空间**: 适当留白，给演唱者换气空间

### 国风特色要点

1. **五声为本**: 严格遵循五声音阶，保持纯净东方感
2. **装饰点睛**: 适度使用装饰音，不宜过多
3. **意境优先**: 旋律服务于歌词意境
4. **留白美学**: 适当的休止和延长增加韵味

### 常见问题

- ❌ 使用4或7音破坏五声音阶
- ❌ 连续大跳进导致旋律不流畅
- ❌ 装饰音过多显得杂乱
- ❌ 忽视歌词的自然语调

---

**准备好将你的歌词转化为动人的国风旋律了吗？**

请提供你的歌词，我将引导你完成旋律创作！🎶
